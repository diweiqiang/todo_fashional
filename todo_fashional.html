<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="todo_fashional.css">
</head>
<body>
<div id="container">
    <h1>todo list <i class="fa fa-plus"></i></h1>
    <div class="slide">
        <input type="text" placeholder="new item">
    </div>
    <ul class="todo-items">
        <!--<li><span><i class="fa fa-trash-o"></i></span>Add a To-Do</li>
        <li><span><i class="fa fa-trash-o"></i></span>Delete a To-Do</li>
        <li><span><i class="fa fa-trash-o"></i></span>Check off a To-Do</li>-->
    </ul>
</div>

<script src="jquery-3.1.0.js"></script>
<script>
    if(/Android|iPhone|iPad|webOS/i.test(navigator.userAgent))
    {
        (function () {
            var todoItems='';
            var length=0;
            //record the start of the touch
            var startX;
            var startY;
            var moveEndX;
            var moveEndY;

            for(var i=0,len=localStorage.length;i<len;i++)
            {
                var key=localStorage.key(i);
                if(key.indexOf('todo')==0)
                {
                    length++;
                    todoItems+=localStorage.getItem(key);
                }
            }

            $('.todo-items').html(todoItems);

            document.querySelectorAll('li').addEventListener('touchend',function () {
                $(this).toggleClass('completed');
            });

            $('h1 i').on('touchend',function () {
                $('.slide').slideToggle();
                $('.slide input').focus();
            });

            $('.slide input').blur(function () {
                var newItem='<li id="todo'+(++length)+'"><span onclick="remove(event,this)"><i class="fa fa-trash-o"></i></span>'+
                    $(this).val()+'</li>';
                $('.todo-items').append(newItem);
                $('.todo-items li:last-child span').click(remove);
                $(this).val('');

                localStorage.setItem('todo'+length,newItem);
            });


            /*$('li').swiperight(function () {
                $(this).find('span').css({width:'2.5em',opacity:'1'});
            }).swipeleft(function () {
                $(this).find('span').css({width:'0',opacity:'0'});
            });

            $('li span').tap(remove);*/

            $('li').on('touchstart',function (e) {
                //e.preventDefault();
                startX=e.originalEvent.changedTouches[0].pageX;
                startY=e.originalEvent.changedTouches[0].pageY;
            });

            $('li').on('touchmove',function (e) {
                //e.preventDefault();
                moveEndX=e.originalEvent.changedTouches[0].pageX;
                moveEndY=e.originalEvent.changedTouches[0].pageY;
                X=moveEndX-startX;
                Y=moveEndY-startY;

                if (Math.abs(X)>Math.abs(Y) && X>0)
                {
                    $(this).find('span').css({width:'2.5em',opacity:'1'});
                }
                else if(Math.abs(X)>Math.abs(Y) && X<0)
                {
                    $(this).find('span').css({width:'0',opacity:'0'});
                }
            });

            $('li span').on('touchend',remove);

            function remove() {
                var item=$(this).parent().attr('id');
                localStorage.removeItem(item);
                $(this).parent().fadeOut(function () {
                    $(this).remove();
                })
            }

        })();
    }
    else
    {
        (function () {
            var todoItems='';
            var length=0;
            for(var i=0,len=localStorage.length;i<len;i++)
            {
                var key=localStorage.key(i);
                if(key.indexOf('todo')==0)
                {
                    length++;
                    todoItems+=localStorage.getItem(key);
                }
            }

            /*
             //var todoItems=localStorage.getItem('todo');
             //console.log(typeof todoItems,todoItems);
             //当todo属性为空的话返回对象null
             if(todoItems==null){
             todoItems='';
             }*/

            $('.todo-items').html(todoItems);

            $('li').click(function () {
                $(this).toggleClass('completed');
            });

            $('li span').click(remove);

            $(".slide input").keyup(function (e) {
                if(e.which==13)
                {
                    var newItem='<li id="todo'+(++length)+'"><span onclick="remove(event,this)"><i class="fa fa-trash-o"></i></span>'+
                        $(this).val()+'</li>';
                    $('.todo-items').append(newItem);
                    $('.todo-items li:last-child span').click(remove);
                    $(this).val('');

                    localStorage.setItem('todo'+length,newItem);
                }
            });

            $('h1 i').click(function () {
                $('.slide').slideToggle();
                $('.slide input').focus();
            });

            function remove() {
                var item=$(this).parent().attr('id');
                localStorage.removeItem(item);
                $(this).parent().fadeOut(function () {
                    $(this).remove();
                })
            }
        })();
    }
</script>
</body>
</html>